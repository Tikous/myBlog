# 重新创建Aurora PostgreSQL数据库

## 🗑️ 删除当前数据库

### 1. 禁用删除保护
- RDS控制台 → 选择集群 `database-1` → 修改
- 取消勾选"启用删除保护" → 立即应用

### 2. 删除集群
- 选择集群 → 操作 → 删除
- 不创建快照 → 输入 `delete me` → 确认删除

## 🆕 创建新的Aurora集群

### 1. 基本配置
```
引擎类型: Amazon Aurora
引擎版本: Aurora PostgreSQL
数据库集群标识符: blog-database
主用户名: postgres
主密码: [设置强密码]
```

### 2. 实例配置
```
数据库实例类别: db.t3.medium (推荐) 或 db.t4g.medium
可用区: 无首选项
```

### 3. 连接设置 ⚠️ 重要
```
网络类型: IPv4
VPC: 默认VPC
数据库子网组: 默认
公有访问: 是 ✅ (这次一定要选择"是")
VPC安全组: 创建新的或选择现有的
```

### 4. 数据库选项
```
初始数据库名称: blog_db
数据库端口: 5432
参数组: 默认
选项组: 默认
```

### 5. 备份设置
```
备份保留期: 7天
备份窗口: 默认
```

### 6. 监控设置
```
启用性能详情: 是
监控角色: 默认
日志导出: 启用PostgreSQL日志
```

### 7. 维护设置
```
启用自动次要版本升级: 是
维护窗口: 默认
删除保护: 否 ✅ (方便以后管理)
```

## 🔧 创建后的配置

### 1. 配置安全组
- 允许你的IP访问端口5432
- 类型: PostgreSQL, 端口: 5432, 源: 你的IP/32

### 2. 获取连接信息
创建完成后，获取:
- 集群终端节点 (写入)
- 集群只读终端节点 (读取)

### 3. 更新环境变量
```env
DATABASE_URL="postgresql://postgres:你的密码@新的集群终端节点:5432/blog_db?schema=public"
DATABASE_WRITE_URL="postgresql://postgres:你的密码@写入终端节点:5432/blog_db?schema=public"
DATABASE_READ_URL="postgresql://postgres:你的密码@只读终端节点:5432/blog_db?schema=public"
```

## 💡 最佳实践建议

### 1. 使用更合适的实例类型
- **db.t3.medium** 或 **db.t4g.medium** (而不是micro)
- 提供更好的性能和稳定性

### 2. 启用多可用区
- 选择"是"来提高可用性
- 自动故障转移

### 3. 合理的备份策略
- 7天备份保留期
- 启用自动备份

### 4. 监控和日志
- 启用性能详情监控
- 导出PostgreSQL日志

## 🚀 创建后的测试

1. **更新项目配置**
   ```bash
   # 更新.env文件后
   npm run db:push
   npm run dev
   ```

2. **测试连接**
   ```bash
   # 如果你还有测试脚本
   ./test-connection.sh
   ```

## ⚠️ 注意事项

1. **数据丢失**: 删除数据库会丢失所有数据
2. **成本**: 新数据库会产生费用
3. **IP白名单**: 确保安全组配置正确
4. **等待时间**: 创建过程需要10-15分钟

删除和重新创建是解决配置问题的最直接方法！ 